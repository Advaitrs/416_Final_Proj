<!DOCTYPE html>
<html>
<head>
    <title>Total COVID Cases per Year</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <div id="chart"></div>
    <script>
        // Width and height of the chart
        const width = 600;
        const height = 400;

        // Create an SVG container
        const svg = d3
            .select("#chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // US States COVID Data URL
        const usStatesCovidURL = "https://advaitrs.github.io/us-states.csv";

        // Helper function to load CSV data using a Promise-based approach
        const loadData = (url) => {
            return new Promise((resolve, reject) => {
                d3.csv(url, (error, data) => {
                    if (error) {
                        reject(error);
                    } else {
                        resolve(data);
                    }
                });
            });
        };

        // Function to load and display the simple bar chart
        const showSimpleBarChart = async () => {
            try {
                const csvData = await loadData(usStatesCovidURL);

                // Parse the date string to extract the year
                const parseDate = d3.timeParse("%Y-%m-%d");
                csvData.forEach((d) => {
                    d.Year = parseDate(d.Date).getFullYear();
                });

                // Group data by year and calculate the total cases for each year
                const casesByYear = d3.group(csvData, (d) => d.Year);
                const totalCasesByYear = Array.from(casesByYear, ([year, cases]) => ({
                    Year: year,
                    TotalCases: d3.sum(cases, (d) => +d.Cases),
                }));

                // Create scales
                const xScale = d3.scaleBand()
                    .domain(totalCasesByYear.map((d) => d.Year))
                    .range([0, width])
                    .padding(0.1);

                const yScale = d3.scaleLinear()
                    .domain([0, d3.max(totalCasesByYear, (d) => d.TotalCases)])
                    .range([height, 0]);

                // Create bars
                const bars = svg.selectAll("rect")
                    .data(totalCasesByYear)
                    .enter()
                    .append("rect")
                    .attr("x", (d) => xScale(d.Year))
                    .attr("y", (d) => yScale(d.TotalCases))
                    .attr("width", xScale.bandwidth())
                    .attr("height", (d) => height - yScale(d.TotalCases))
                    .attr("fill", "steelblue");

                // Add axes
                const xAxis = d3.axisBottom(xScale);
                const yAxis = d3.axisLeft(yScale);

                svg.append("g")
                    .attr("transform", `translate(0, ${height})`)
                    .call(xAxis);

                svg.append("g")
                    .call(yAxis);
            } catch (error) {
                console.error("Error loading US States COVID Data:", error);
            }
        };

        // Call the function to load and display the simple bar chart when the page loads
        showSimpleBarChart();

    </script>
</body>
</html>
